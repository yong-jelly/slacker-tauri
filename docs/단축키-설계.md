# 키보드 단축키 및 네비게이션 설계

이 문서는 미루미(MIRUMI) 앱의 키보드 단축키 시스템, 태스크 네비게이션 및 사용자 가이드 UI의 설계와 구현 상세를 설명합니다.

## 1. 개요

사용자의 생산성을 극대화하기 위해 키보드 중심의 워크플로우를 지원합니다. 중앙집중식 단축키 관리, 컨텍스트 기반의 네비게이션, 그리고 사용자가 단축키를 쉽게 학습할 수 있는 가이드 UI를 제공합니다.

## 2. 단축키 정의 (`src/shared/lib/shortcuts.ts`)

모든 단축키는 `ShortcutDef` 인터페이스를 통해 정의되며, 카테고리별로 관리됩니다.

### 2.1 네비게이션 (Navigation)
| ID | 키 | 설명 |
| :--- | :--- | :--- |
| `nav-inbox` | `⌘+1` | 할일 메뉴로 이동 |
| `nav-completed` | `⌘+2` | 완료 메뉴로 이동 |
| `nav-starred` | `⌘+3` | 중요 메뉴로 이동 |
| `nav-today` | `⌘+4` | 오늘 메뉴로 이동 |
| `nav-tomorrow` | `⌘+5` | 내일 메뉴로 이동 |
| `nav-overdue` | `⌘+6` | 지연됨 메뉴로 이동 |
| `nav-archive` | `⌘+7` | 보관함 메뉴로 이동 |

### 2.2 태스크 관리 (Task Management)
| ID | 키 | 설명 |
| :--- | :--- | :--- |
| `add-task` | `⌘+N` | 새 태스크 추가 |
| `toggle-play` | `Enter` | 태스크 시작/정지 |
| `complete-task` | `⌘+D` | 태스크 완료 처리 |
| `delete-task` | `⌘+⌫` | 태스크 삭제 |
| `star-task` | `⌘+S` | 중요 표시 토글 |
| `nav-up` | `↑ / K` | 이전 태스크로 포커스 이동 |
| `nav-down` | `↓ / J` | 다음 태스크로 포커스 이동 |
| `expand-task` | `Space` | 태스크 상세 열기/닫기 |

### 2.3 앱 컨트롤 (App Control)
| ID | 키 | 설명 |
| :--- | :--- | :--- |
| `toggle-sidebar` | `⌘+B` | 사이드바 토글 |
| `toggle-widget` | `⌘+W` | 위젯 모드 전환 |
| `show-help` | `⌘+/` | 단축키 도움말 모달 열기 |
| `settings` | `⌘+,` | 설정 페이지로 이동 |

## 3. 구현 상세

### 3.1 중앙 단축키 훅 (`useKeyboardShortcuts`)
- `window` 레벨에서 `keydown` 이벤트를 캡처합니다.
- **플랫폼 인식**: macOS에서는 `Meta` 키를, Windows/Linux에서는 `Ctrl` 키를 기본 수정 키로 사용합니다.
- **입력 보호**: `input`, `textarea` 등 입력 요소에 포커스가 있을 경우, 수정 키가 없는 단축키(예: Space, J, K)는 동작하지 않도록 방지합니다.
- **이벤트 전파 제어**: 매칭된 단축키 실행 시 `event.preventDefault()`를 호출하여 브라우저 기본 동작을 억제합니다.

### 3.2 태스크 네비게이션 훅 (`useTaskKeyboardNavigation`)
- **포커스 상태 관리**: 현재 화면에 보이는 태스크 목록(`visibleTasks`)을 기반으로 `focusedTaskId`를 관리합니다.
- **부드러운 스크롤**: 포커스 이동 시 `scrollIntoView({ behavior: "smooth", block: "nearest" })`를 사용하여 포커스된 항목이 항상 화면에 보이도록 유지합니다.
- **유효성 검사**: 태스크 목록이 변경되거나 필터링될 때, 현재 포커스된 태스크가 여전히 유효한지 확인하고 필요 시 초기화합니다.

## 4. 사용자 가이드 UI

사용자가 단축키를 자연스럽게 익힐 수 있도록 세 가지 단계의 가이드를 제공합니다.

### 4.1 전체 도움말 모달 (`KeyboardShortcutsHelp`)
- `Cmd + /`로 호출하며, 모든 단축키를 카테고리별로 상세히 보여줍니다.
- 미니멀한 다크 테마 디자인과 애니메이션(`motion`)이 적용되어 있습니다.
- `Escape` 키 또는 백드롭 클릭으로 닫을 수 있습니다.

### 4.2 CMD 홀드 오버레이 (`CommandKeyOverlay`)
- `Cmd` 키를 **0.5초 이상 단독으로 홀드**할 때 나타나는 일시적인 가이드입니다.
- 핵심적인 단축키들만 컴팩트하게 보여주며, 키를 떼면 즉시 사라집니다.
- `useModifierHold` 훅을 통해 구현되었습니다.

### 4.3 상시 힌트 바 (`ShortcutHintBar`)
- 앱 하단에 위치하며, 현재 선택된 메뉴에 따라 가장 자주 쓰이는 단축키 힌트를 보여줍니다.
- 예: 할일 메뉴에서는 `⌘N 추가`, `Enter 시작/정지`, `Space 상세` 등을 표시합니다.

### 4.4 사이드바 힌트
- 사이드바의 각 메뉴 아이템 옆에 해당 메뉴로 즉시 이동할 수 있는 숫자 단축키(`⌘1`, `⌘2` 등)를 작게 표시합니다.
- 평소에는 흐리게 표시되거나 호버 시에만 나타나 미니멀한 UI를 유지합니다.

## 5. 플랫폼 지원
- **macOS**: `⌘ (Command)` 키를 주 수정 키로 사용합니다.
- **Windows/Linux**: `Ctrl` 키를 주 수정 키로 사용하도록 내부적으로 매핑됩니다.
- 특수 키 기호(⌘, ⌫ 등)는 가이드 UI에서 플랫폼에 맞게 적절히 표시됩니다.
